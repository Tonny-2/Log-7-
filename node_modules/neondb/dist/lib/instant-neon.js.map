{"version":3,"file":"instant-neon.js","names":[],"sources":["../../src/lib/instant-neon.ts"],"sourcesContent":["import { randomUUID } from \"node:crypto\";\nimport { log } from \"@clack/prompts\";\nimport { seedDatabase } from \"./seed-database.js\";\nimport { messages } from \"./texts.js\";\nimport type { InstantNeonParams } from \"./types.js\";\nimport { createClaimableDatabase } from \"./utils/create-db.js\";\nimport { getPoolerString } from \"./utils/format.js\";\nimport { writeToEnv } from \"./utils/fs.js\";\nimport { LAUNCHPAD_URLS } from \"./utils/urls.js\";\n\n/**\n * Creates an instant Postgres connection string from Instagres by Neon\n * if not already set in the specified .env file.\n * Prompts the user to optionally generate a connection string,\n * saves it to the .env file, and returns the connection string.\n */\nexport const instantNeon = async ({\n\tdotEnvFile = \".env\",\n\tdotEnvKey = \"DATABASE_URL\",\n\treferrer = \"unknown\",\n\tseed = undefined,\n\tenvPrefix = \"PUBLIC_\",\n}: InstantNeonParams) => {\n\tconst dbId = randomUUID();\n\tconst claimExpiresAt = new Date(Date.now() + 3 * 24 * 60 * 60 * 1000);\n\tconst claimUrl = new URL(LAUNCHPAD_URLS.CLAIM_DATABASE(dbId));\n\n\tconst connString = await createClaimableDatabase(\n\t\tdbId,\n\t\t`npm:neondb|${referrer}`,\n\t);\n\tconst poolerString = getPoolerString(connString);\n\n\tlog.step(messages.connectionString(connString));\n\tlog.step(messages.poolerString(poolerString));\n\n\tawait writeToEnv(\n\t\tdotEnvFile,\n\t\tdotEnvKey,\n\t\tclaimExpiresAt,\n\t\tclaimUrl,\n\t\tconnString,\n\t\tpoolerString,\n\t\tenvPrefix,\n\t);\n\n\tlog.success(messages.envSuccess(dotEnvFile, dotEnvKey));\n\tlog.info(messages.databaseGenerated(claimUrl.href));\n\n\tif (seed) {\n\t\tlog.step(\"Pushing schema to database\");\n\t\tawait seedDatabase(seed.path, connString);\n\t\tlog.success(\"Schema pushed to database\");\n\t}\n\n\treturn {\n\t\tdatabaseUrl: connString,\n\t\tpoolerUrl: poolerString,\n\t\tclaimUrl: claimUrl.href,\n\t\tclaimExpiresAt,\n\t} as const;\n};\n\nexport type { InstantNeonParams };\n"],"mappings":";;;;;;;;;;;;;;;;AAgBA,MAAa,cAAc,OAAO,EACjC,aAAa,QACb,YAAY,gBACZ,WAAW,WACX,OAAO,QACP,YAAY,gBACY;CACxB,MAAM,OAAO,YAAY;CACzB,MAAM,iBAAiB,IAAI,KAAK,KAAK,KAAK,GAAG,OAAc,KAAK,IAAK;CACrE,MAAM,WAAW,IAAI,IAAI,eAAe,eAAe,KAAK,CAAC;CAE7D,MAAM,aAAa,MAAM,wBACxB,MACA,cAAc,WACd;CACD,MAAM,eAAe,gBAAgB,WAAW;AAEhD,KAAI,KAAK,SAAS,iBAAiB,WAAW,CAAC;AAC/C,KAAI,KAAK,SAAS,aAAa,aAAa,CAAC;AAE7C,OAAM,WACL,YACA,WACA,gBACA,UACA,YACA,cACA,UACA;AAED,KAAI,QAAQ,SAAS,WAAW,YAAY,UAAU,CAAC;AACvD,KAAI,KAAK,SAAS,kBAAkB,SAAS,KAAK,CAAC;AAEnD,KAAI,MAAM;AACT,MAAI,KAAK,6BAA6B;AACtC,QAAM,aAAa,KAAK,MAAM,WAAW;AACzC,MAAI,QAAQ,4BAA4B;;AAGzC,QAAO;EACN,aAAa;EACb,WAAW;EACX,UAAU,SAAS;EACnB;EACA"}